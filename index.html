<!doctype html>
<html lang="it">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Registro Scuola</title>
    <link rel="stylesheet" href="style.css" />
    <style>
        /* Stile per i pulsanti di eliminazione nelle liste */
        .delete-item-btn {
            margin-left: 10px;
            padding: 2px 6px;
            font-size: 0.8em;
            background-color: #f44336; /* Rosso */
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .delete-item-btn:hover {
            background-color: #d32f2f;
        }
        /* Nuovo stile per l'input di ricerca */
        #searchStudentInput {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 8px;
            width: 100%;
            max-width: 300px;
            margin-bottom: 12px;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-left">
            <button id="homeBtn" class="btn">Home</button>
            <button id="importBtnHeader" class="btn">Importa</button>
        </div>

        <h1>Registro Scuola — Licei</h1>

        <div class="header-right">
            <span id="userInfo" class="user-info"></span>
            <button id="loginBtn" class="btn">Accedi (Google)</button>
            <button id="logoutBtn" class="btn" style="display:none;">Esci</button>
            <button id="backBtn" class="btn">Indietro</button>
        </div>
    </header>

    <main id="app">
        <section id="dashboard" class="screen">
            <h2>Seleziona un Liceo e una Classe</h2>
            <input type="text" id="searchStudentInput" placeholder="Cerca studente nella classe..." style="display:none;">
            <div id="schoolsContainer" class="grid"></div>
            <div class="timetable-control">
                <button id="showTimetableBtn" class="btn">Orario Settimanale</button>
                <button id="showClassBtn" class="btn" style="display:none;">Vai alla Classe</button>
            </div>
        </section>

        <section id="classView" class="screen" style="display:none;">
            <div class="class-header">
                <h2 id="classTitle"></h2>
                <div style="display: flex; gap: 8px;">
                    <button id="exportXLSXBtn" class="btn secondary-btn">Esporta XLSX</button>
                    <button id="addStudentBtn" class="btn">Aggiungi alunno</button>
                </div>
            </div>
            <div class="class-notes-container">
                <button id="toggleNotesBtn" class="btn">Mostra/Nascondi Appunti</button>
                <div id="notesSection" style="display:none; margin-top: 15px;">
                    <h4>Appunti sulla classe (programma, note, etc.)</h4>
                    <textarea id="classNotesTextarea" rows="8" placeholder="Scrivi qui a che punto sei arrivato con il programma..."></textarea>
                    <button id="saveNotesBtn" class="btn">Salva Appunti</button>
                    <span id="notesStatus" class="small-note" style="margin-left: 10px;"></span>
                </div>
            </div>
            <table id="studentsTable" class="striped">
                <thead>
                    <tr><th>#</th><th>Nome</th><th>Voti</th><th>Annotazioni</th><th>Azioni</th></tr>
                </thead>
                <tbody></tbody>
            </table>
        </section>

        <section id="timetableSection" class="screen" style="display:none;">
            <div class="class-header">
                <h2>Orario settimanale</h2>
                <div>
                    <button id="editTimetableBtn" class="btn">Modifica</button>
                    <button id="saveTimetableBtn" class="btn" style="display:none;">Salva</button>
                </div>
            </div>

            <table id="timetable" class="striped">
                <thead>
                    <tr>
                        <th>Ora</th>
                        <th>Lunedì</th>
                        <th>Martedì</th>
                        <th>Mercoledì</th>
                        <th>Giovedì</th>
                        <th>Venerdì</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </section>

        <section id="importSection" class="screen" style="display:none;">
            <h2>Importa studenti da file Excel</h2>
            <div class="controls">
                <label class="file-label">File .xlsx
                    <input id="xlsxInput" type="file" accept=".xls,.xlsx" />
                </label>
                <select id="sheetSelect" style="display:none;"></select>
                <label> Classe destinazione:
                    <select id="importClassSelect">
                        <option value="scientifico-1">Scientifico I</option>
                        <option value="scientifico-2">Scientifico II</option>
                        <option value="scientifico-3">Scientifico III</option>
                        <option value="scientifico-4">Scientifico IV</option>
                        <option value="scientifico-5">Scientifico V</option>
                        <option value="linguistico-1">Linguistico I</option>
                        <option value="linguistico-2">Linguistico II</option>
                        <option value="linguistico-3">Linguistico III</option>
                        <option value="linguistico-4">Linguistico IV</option>
                        <option value="linguistico-5">Linguistico V</option>
                    </select>
                </label>
                <label><input type="checkbox" id="hasHeader" checked> Salta riga d'intestazione</label>
                <label><input type="checkbox" id="tryDedupe" checked> Non importare duplicati (solo nome)</label>
                <button id="previewBtn" class="btn" style="display:none;">Anteprima</button>
                <button id="doImportBtn" class="btn" style="display:none;">Importa in classe</button>
            </div>
            <div id="previewArea" style="margin-top: 15px; display:none;">
                <h4>Anteprima Dati:</h4>
                <pre id="previewContent"></pre>
            </div>
        </section>

    </main>

    <div id="studentModal" class="modal-overlay" style="display:none;">
        <div class="modal-card">
            <div class="modal-header">
                <h2 id="studentName"></h2>
                <button id="closeModalBtn" class="btn close-btn">X</button>
            </div>

            <div class="student-summary">
                <p>Totale voti: <span id="gradesCount"></span></p>
                <p>Totale annotazioni: <span id="notesCount"></span></p>
            </div>

            <div class="student-details">
                <div class="student-forms">
                    <form id="gradeForm" class="mini-form">
                        <h3>Aggiungi voto</h3>
                        <label>Voto <input name="value" type="number" min="0" max="10" step="0.25" required /></label>
                        <label>Descrizione <input name="description" type="text" placeholder="es. Prova orale storia" /></label>
                        <label>Data <input name="date" type="date" /></label>
                        <button type="submit" class="btn">Salva voto</button>
                    </form>

                    <form id="noteForm" class="mini-form">
                        <h3>Aggiungi annotazione</h3>
                        <label>Testo <textarea name="text" rows="3" required></textarea></label>
                        <button type="submit" class="btn">Salva annotazione</button>
                    </form>
                </div>
                <div class="student-history">
                    <h3>Storico voti</h3>
                    <ul id="gradesList"></ul>
                    <h3>Annotazioni</h3>
                    <ul id="notesList"></ul>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script type="module" src="app.js"></script>
</body>
</html>
